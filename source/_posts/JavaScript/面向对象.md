---
title: 面向对象
date: 2019-05-16 07:19:20
tags:
categories:
	- JavaScript
---

> 学习面向对象的思想，从本质理解原型链

<!--more-->

## new

### 不使用new

**创造一个士兵**

```javascript
var 士兵 = {
  ID: 1, // 用于区分每个士兵
  兵种:"美国大兵",
  攻击力:5,
  生命值:42, 
  行走:function(){ /*走俩步的代码*/},
  奔跑:function(){ /*狂奔的代码*/  },
  死亡:function(){ /*Go die*/    },
  攻击:function(){ /*糊他熊脸*/   },
  防御:function(){ /*护脸*/       }
}

兵营.制造(士兵)
```

哎呦不错哦！

**创造100个士兵**

```javascript
var 士兵们 = []
var 士兵
for(var i=0; i<100; i++){
  士兵 = {
    /*...*/
  }
  士兵们.push(士兵)
}

兵营.批量制造(士兵们)
```

好蠢，浪费了很多内存。而且有很多属性是可以提出来公用，没有必要创建100次，可以通过id和生命值来区分每个士兵

**改进**

用原型链可以解决重复创建的问题：我们先创建一个「士兵原型」，然后让「士兵」的 __proto__ 指向「士兵原型」

```javascript
var 士兵原型 = {
  兵种:"美国大兵",
  攻击力:5,
  行走:function(){ /*走俩步的代码*/}，
  /*...*/
  防御:function(){ /*护脸*/       }
}
var 士兵们 = []
var 士兵
for(var i=0; i<100; i++){
  士兵 = {
    ID: i, // ID 不能重复
    生命值:42
  }

  /*实际工作中不要这样写，因为 __proto__ 不是标准属性*/
  士兵.__proto__ = 士兵原型 

  士兵们.push(士兵)
}

兵营.批量制造(士兵们)
```

**优雅？**

创建一个士兵的代码分散在两个地方很不优雅，于是我们用一个函数把这两部分联系起来

```javascript
function 士兵(ID){
    var 临时对象 = {
        ID = ID,
        生命值 = 42 
    }

  临时对象.__proto__ = 士兵.原型 
  return 临时对象
}

士兵.原型 = {
  兵种:"美国大兵",
  攻击力:5,
  行走:function(){ /*走俩步的代码*/}，
  /*...*/
  防御:function(){ /*护脸*/       }
}
```

舒服了！然后就可以愉快地引用「士兵」来创建士兵了

```javascript
var 士兵们 = []
for(var i=0; i<100; i++){
  士兵们.push(士兵(i))
}

兵营.批量制造(士兵们)
```



### 使用new

来自JS之父的关怀，给我们吃糖，让我们愉快的写代码

使用 new 关键字，那么可以少做四件事情：

1. 不用创建临时对象，因为 new 会帮你做（**你使用「this」就可以访问到临时对象**）；
2. 不用绑定原型，因为 new 会帮你做（new 为了知道原型在哪，所以指定原型的名字为 prototype）；
3. 不用 return 临时对象，因为 new 会帮你做；
4. 不要给原型想名字了，因为 new 指定名字为 prototype

```javascript
function 士兵(ID){
  this.ID = ID
  this.生命值 = 42
}

士兵.prototype = {
  兵种:"美国大兵",
  攻击力:5,
  行走:function(){ /*走俩步的代码*/},
  /*...*/
  防御:function(){ /*护脸*/       }
}
```

```javascript
var 士兵们 = []
for(var i=0; i<100; i++){
  士兵们.push(new 士兵(i))
}

兵营.批量制造(士兵们)
```



### 注意 constructor 属性

new 操作为了记录「临时对象是由哪个函数创建的」，所以预先给「士兵.prototype」加了一个 constructor 属性：

```javascript
士兵.prototype = {
  constructor: 士兵
}
```

如果你重新对「士兵.prototype」赋值，那么这个 constructor 属性就没了，所以你应该这么写：

```javascript
士兵.prototype.兵种 = "美国大兵"
士兵.prototype.攻击力 = 5
士兵.prototype.行走 = function(){ /*走俩步的代码*/}
/*...*/
士兵.prototype.防御 = function(){ /*护脸*/       }
```

或者你也可以自己给 constructor 重新赋值：

```javascript
士兵.prototype = {
  constructor: 士兵, // 自己加
  兵种:"美国大兵",
  攻击力:5,
  行走:function(){ /*走俩步的代码*/},
  /*...*/
  防御:function(){ /*护脸*/       }
}
```



### 总结

通过new来理解原来学过的原型链

```javascript
var object = new Object()

// 自有属性为空
object.__proto__ === Object.prototype

var array = new Array('a', 'b', 'c')

// 自有属性为 0:'a' 1:'b', 2:'c',length: 3
array.__proto__ === Array.prototype

Array.prototype.__proto__ === Object.prototype // true

Array.__proto__ == Function.prototype // true
```